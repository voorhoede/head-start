---
import { getLocale, locales, t } from '@lib/i18n';
import type { SiteLocale } from '@lib/types/datocms';
import type { PageUrl } from '@lib/seo';

const activeLocale = getLocale();

interface Props {
  pageUrls: PageUrl[],
}
const { pageUrls } = Astro.props;

const getPageHref = (locale: SiteLocale) => {
  const pageUrl = pageUrls.find((pageUrl) => pageUrl.locale === locale);
  return pageUrl
    ? new URL(pageUrl.pathname, Astro.site)
    : new URL(`/${ locale }/`, Astro.site);
};
---
<locale-selector>
  <nav aria-labelledby="locale-selector-title">
    <span id="locale-selector-title" class="sr-only">
      { t('select_language') }
    </span>
    <ul role="list" style="list-style: none;">
      { locales.map(locale => (
        <li>
          <a hreflang={ locale }
            href={ getPageHref(locale as SiteLocale) }
            aria-current={ locale === activeLocale ? 'page' : 'false' }>
            { locale }
          </a>
        </li>
      )) }
    </ul>
  </nav>
</locale-selector>

<script src="./LocaleSelector.client.ts"></script>

<style>
  /* functional styling */
  .sr-only {
    /* @see https://tailwindcss.com/docs/screen-readers */
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }

  /* basic styling, can be removed */
  ul {
    margin: 0;
    margin-inline-end: 20px;
    padding: 0;
  }
  li {
    display: inline-block;
    margin-right: 10px;
  }
</style>
