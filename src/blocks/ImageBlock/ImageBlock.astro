---
import type { ImageBlockFragment } from '../../lib/types/datocms';

interface Props {
  block: ImageBlockFragment
}

const { block } = Astro.props;
const { image } = block;
const altText = image.alt ? image.alt : ''; // default to empty string for accessibility
const isResponsiveImage = Boolean(image.responsiveImage);
const loadingStrategy = 'lazy';
---

<figure>
  {
    isResponsiveImage
      ? // bitmap images have Imgix generated props (responsiveImage.*):
      <img
        alt={ altText }
        loading={ loadingStrategy }
        sizes={ image.responsiveImage.sizes }
        srcSet={ image.responsiveImage.srcSet }
        src={ image.responsiveImage.src }
        style={{
          aspectRatio: image.responsiveImage.aspectRatio,
          backgroundColor: image.responsiveImage.bgColor,
          backgroundImage: `url(${image.responsiveImage.base64})`
        }}
      />
      : // vector images do not have Imgix generated props, so using as is:
      <img 
        alt={ altText }
        loading={ loadingStrategy }
        src={ image.url } 
        style={{
          aspectRatio: `${image.width}/${image.height}`,
        }}
      />
  }
  { image.title && (
    <figcaption>
      { image.title }
    </figcaption>
  )}
</figure>

<style>
img {
  display: block;
  width: 100%;
  background-size: cover;
}
</style>
