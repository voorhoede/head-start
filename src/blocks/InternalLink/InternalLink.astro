---
import type {
  InternalLinkFragment,
  PageRecord,
  SiteLocale,
} from '@lib/types/datocms';
import Link from '@components/Link/Link.astro';
import { getPagePath } from './index';

export interface Props {
  link: InternalLinkFragment;
  openInNewTab?: boolean;
}
type Params = {
  locale: SiteLocale;
};

const { link, openInNewTab, ...props } = Astro.props;
const { locale } = Astro.params as Params;
const { title, page } = link;

// Determine pathname based on record type
const getHref = ({
  locale,
  page,
}: {
  locale: SiteLocale;
  page: InternalLinkFragment['page'];
}) => {
  const pathParams = {
    HomePageRecord: [],
    PageRecord: [getPagePath({ page: page as PageRecord, locale })],
  }[page.__typename];

  return `/${[locale, ...pathParams].filter(Boolean).join('/')}/`;
};

const href = getHref({ locale, page });

---

<Link {href} {openInNewTab} {...props}><slot>{title}</slot></Link>
