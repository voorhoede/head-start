---
import FileLink from '@blocks/File/FileLink.astro';
import InternalLink from '@blocks/InternalLink/InternalLink.astro';
import type {
  FileLinkFragment,
  InternalLinkFragment,
} from '@lib/types/datocms';

type Node = {
  meta?: {
    id: string;
    value: string;
  }[];
};
type Props = {
  node: Node;
  link: FileLinkFragment | InternalLinkFragment;
};

const { node, link } = Astro.props;
const openInNewTab = Boolean(
  node.meta?.find((entry) => entry.id === 'target' && entry.value === '_blank')
);
const isType = (type: string) => link.__typename === type;
---

{
  isType('InternalLinkRecord') ? (
    <InternalLink link={link as InternalLinkFragment} {openInNewTab}>
      <slot />
    </InternalLink>
  ) : isType('FileRecord') ? (
    <FileLink link={link as FileLinkFragment}>
      <slot />
    </FileLink>
  ) : (
    <slot />
  )
}
