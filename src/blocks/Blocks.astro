---
import type { 
  ImageBlockFragment,
  TableBlockFragment,
  TextBlockFragment,
  VideoEmbedBlockFragment,
} from '../lib/types/datocms';
import ImageBlock from './ImageBlock/ImageBlock.astro';
import TableBlock from './TableBlock/TableBlock.astro';
import TextBlock from './TextBlock/TextBlock.astro';
import VideoEmbedBlock from './VideoEmbedBlock/VideoEmbedBlock.astro';

const blocksByTypename = {
  ImageBlockRecord: ImageBlock,
  TableBlockRecord: TableBlock,
  TextBlockRecord: TextBlock,
  VideoEmbedBlockRecord: VideoEmbedBlock,
};

type AnyBlock = 
  | ImageBlockFragment
  | TableBlockFragment
  | TextBlockFragment
  | VideoEmbedBlockFragment;

interface Props {
  blocks: AnyBlock[];
}
const { blocks } = Astro.props;
---
{ blocks.map((block) => {
  const typename = String(block.__typename);
  const Block = blocksByTypename[typename];
  return Block
    ? <Block block={ block } />
    : <script define:vars={{ typename }} is:inline>
        console.log(`No Block found for "${typename}"`);
    </script>;
})}
