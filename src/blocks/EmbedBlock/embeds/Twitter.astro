---
import { extractScripts } from '../index';
import type { OEmbedRich } from '../index';
import Icon from '@components/Icon';

const data = Astro.props.data as OEmbedRich;
const { noscriptHtml, scripts } = extractScripts(data.html);
---

<twitter-embed data-enhanced="false">
  <Icon name="twitter" />
  <div
    set:html={noscriptHtml}
    style={{
      'aspect-ratio': data.width && data.height ? data.width / data.height : null,
      'max-width': data.width ? `${data.width}px` : null,
    }}
  />
  { scripts.map(({ src, ...attributes }) => (
    <script data-src={ src } {...attributes} />
  )) }
</twitter-embed>

<script src="./Twitter.client.ts"></script>

<style>
  twitter-embed {
    display: block;
    position: relative;
  }
  twitter-embed[data-enhanced="false"] {
    border: 1px solid black;
    border-radius: 5px;
  }

  twitter-embed[data-enhanced="true"] [data-icon="twitter"] {
    display: none;
  }
  twitter-embed[data-enhanced="false"] [data-icon="twitter"] {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 15px;
    height: 15px;
  }
</style>
