---
import getVideoId from 'get-video-id';
import VideoEmbedBlock from '@blocks/VideoEmbedBlock/VideoEmbedBlock.astro';
import type { VideoEmbedBlockFragment } from '@lib/types/datocms';
import type { OEmbedRich } from '../index';

type OEmbedYouTube = OEmbedRich & {
  video_id: string;
  thumbnail_url: string;
  title: string;
  height: number;
  width: number;
};
type Props = {
  data: OEmbedYouTube;
  url: string;
};

const { data, url } = Astro.props;
const videoId = getVideoId(url).id || '';
const block: VideoEmbedBlockFragment = {
  id: data.video_id,
  video: {
    provider: 'youtube',
    providerUid: videoId,
    thumbnailUrl: data.thumbnail_url,
    title: data.title,
    url: url,
    height: data.height,
    width: data.width,
  },
  title: data.title,
  autoplay: false,
  mute: false,
  loop: false,
};
---

<VideoEmbedBlock block={block} />
