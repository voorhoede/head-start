---
import { datocmsRequest } from '@lib/datocms';
import type { HomeQuery, HomeRecord } from '@lib/types/datocms';
import homeQuery from './index.query.graphql';
import Layout from '@layouts/Default.astro';
import Blocks from '@blocks/Blocks.astro';
import type { AnyBlock } from '@blocks/Blocks';
import ShareButton from '@components/ShareButton/ShareButton.astro';
import { locales } from '@lib/i18n';

export async function getStaticPaths() {
  return locales.map(locale => ({ params: { locale } }));
}

const { locale } = Astro.params;
const { page } = await datocmsRequest<HomeQuery>({ query: homeQuery, variables: { locale } }) as { page: HomeRecord };
const pageUrls = locales.map(locale => ({ locale, pathname: `/${locale}/` }));
---
<Layout 
  pageUrls={pageUrls}
  seoMetaTags={page._seoMetaTags}
>
  <h1>{page.title}</h1>
  <Blocks blocks={page.bodyBlocks as AnyBlock[]} />
  <ShareButton />
</Layout>
