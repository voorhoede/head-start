---
import { datocmsCollection, datocmsRequest } from '@lib/datocms';
import type { PageQuery } from '@lib/types/datocms.d.ts';
import pageQuery from './index.query.graphql';
import Layout from '@layouts/Default.astro';
import Blocks from '@blocks/Blocks.astro';
import ShareButton from '@components/ShareButton/ShareButton.astro';

export async function getStaticPaths() {
  interface PagesCollectionItem {
    slugs: Array<{ locale: string; value: string; }>;
  }
  const pages = await datocmsCollection<PagesCollectionItem>({ 
    collection: 'Pages',
    fragment: `slugs: _allSlugLocales { locale, value }`,
  });
  return pages.flatMap(page => page.slugs.map((slug) => ({
    params: { locale: slug.locale, slug: slug.value }
  })));
}

const { locale } = Astro.params;
const { page } = await datocmsRequest<PageQuery>({ query: pageQuery, variables: { locale, slug: Astro.params.slug } });
const pageUrls = page._allSlugLocales.map(slug => ({ locale: slug.locale, pathname: `/${slug.locale}/${slug.value}/` }));
---

<Layout 
  pageUrls={pageUrls}
  seoMetaTags={page._seoMetaTags}
>
  <h1>{page.title}</h1>
  <Blocks blocks={page.bodyBlocks} />
  <ShareButton />
</Layout>
