---
import { datocmsRequest, PageQuery } from '../../../lib/datocms';
import type { SlugPathsQuery } from '../../../lib/datocms.d';
import slugPathsQuery from './paths.query.graphql';
import pageQuery from './index.query.graphql';
import Layout from '../../../layouts/Default.astro';

import { setLocale, t } from '../../../lib/i18n';

export async function getStaticPaths() {
  const data = await datocmsRequest({ query: slugPathsQuery }) as SlugPathsQuery;

  return data.pages.flatMap(page => page.slugs.map((slug) => ({
    params: { locale: slug.locale, slug: slug.value }
  })));
}

const locale = setLocale(Astro.params.locale);
const { page } = await datocmsRequest({ query: pageQuery, variables: { locale, slug: Astro.params.slug } }) as PageQuery;
---

<Layout>
  <h1>{page.title}</h1>
  { t('share_on_social') }
</Layout>
